<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vicky ‚Ä¢ My Friends ‚Äî Premium</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1: #050014;
    --bg2: #071028;
    --glass: rgba(255,255,255,0.04);
    --glass-strong: rgba(255,255,255,0.06);
    --accent1: #00f0ff;
    --accent2: #ff4dd2;
    --accent3: #8aff6b;
    --card-radius: 14px;
    --fw-title: 700;
    --glass-border: rgba(255,255,255,0.06);
    --muted: rgba(234,246,255,0.6);
  }

  /* Reset */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: "Inter", "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(0,240,255,0.04), transparent), linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 65%);
    color: #eaf6ff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-y:scroll;
    min-height:100vh;
  }

  /* Top sticky header */
  header.top{
    position:sticky; top:12px; z-index:10; margin:16px auto; max-width:1200px; padding:12px; border-radius:12px;
    backdrop-filter: blur(8px) saturate(120%);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    display:flex; align-items:center; justify-content:space-between; gap:16px;
  }
  .wrap{ max-width:1200px; margin:24px auto; padding:0 20px 40px; z-index:2; }

  .brand{ display:flex; gap:14px; align-items:center }
  .logo {
    width:64px; height:64px; border-radius:14px;
    background: linear-gradient(135deg,var(--accent2),var(--accent1));
    display:flex; align-items:center; justify-content:center;
    font-weight:800; color:#050015; font-size:22px; box-shadow: 0 8px 28px rgba(0,0,0,0.6);
    transform: translateZ(0);
    position:relative;
    overflow:hidden;
  }
  /* animated gradient inside logo */
  .logo::after{
    content:""; position:absolute; inset:0; background:linear-gradient(120deg, rgba(255,255,255,0.05), rgba(255,255,255,0)); mix-blend-mode:overlay; pointer-events:none;
  }
  .title h1{ font-family:'Poppins',sans-serif; font-size:18px; margin-bottom:4px; font-weight:700; letter-spacing:0.2px; }
  .title p{ font-size:13px; color:var(--muted) }

  /* Controls */
  .controls{ display:flex; gap:10px; align-items:center }
  .btn{ border-radius:10px; padding:8px 12px; font-weight:600; font-size:13px; background:transparent; border:1px solid var(--glass-border); color:#fff; cursor:pointer; backdrop-filter: blur(6px); }
  .btn.primary{ background: linear-gradient(90deg, rgba(0,240,255,0.06), rgba(255,77,210,0.05)); border:1px solid rgba(0,240,255,0.12); }
  .btn.ghost{ background:transparent; border:1px dashed rgba(255,255,255,0.03) }

  .searchWrap{ display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); }
  .searchWrap input{ background:transparent; border:0; outline:none; color: #eaf6ff; width:220px; font-size:14px }

  /* Gallery grid */
  main{ margin-top:20px }
  .gallery{ display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:20px; margin-top:18px }

  .card{ border-radius:var(--card-radius); overflow:hidden; position:relative; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); box-shadow: 0 10px 30px rgba(0,0,0,0.6); transition: transform .28s cubic-bezier(.15,.8,.25,1), box-shadow .28s; }
  .card:hover{ transform:translateY(-10px) scale(1.02); box-shadow: 0 24px 60px rgba(0,0,0,0.75), 0 0 28px rgba(255,77,210,0.05); }

  .avatar-wrap{ height:220px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative }
  .avatar-wrap img{ width:100%; height:100%; object-fit:cover; display:block; transition: transform .45s cubic-bezier(.2,.9,.3,1); }
  .card:hover .avatar-wrap img{ transform: scale(1.06) translateY(-6px); filter:contrast(1.04); }

  .info{ padding:12px; text-align:center; display:flex; flex-direction:column; gap:8px; }
  .name{ font-weight:700; font-size:15px; color:#fff }
  .meta{ font-size:13px; color:var(--muted) }

  .insta-btn{ display:inline-flex; gap:10px; align-items:center; padding:8px 12px; border-radius:999px; font-weight:700; font-size:13px; text-decoration:none; color:#fff; background:linear-gradient(90deg, rgba(255,77,210,0.12), rgba(0,240,255,0.12)); border:1px solid rgba(255,255,255,0.04); }
  .insta-btn i{ filter: drop-shadow(0 6px 18px rgba(0,0,0,0.6)); }

  .card-controls{ display:flex; gap:8px; justify-content:center }
  .admin-only{ display:none }

  /* Modal viewer */
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:80; background: rgba(0,0,0,0.6); }
  .modal.open{ display:flex }
  .modal .box{ width:min(90%,1100px); max-height:90vh; border-radius:12px; overflow:hidden; background:#0b1220; border:1px solid rgba(255,255,255,0.04); box-shadow:0 40px 120px rgba(0,0,0,0.8); display:grid; grid-template-columns: 1fr 360px }
  .modal .imgWrap{ background:#000; display:flex; align-items:center; justify-content:center }
  .modal .imgWrap img{ width:100%; height:100%; object-fit:contain }
  .modal .side{ padding:18px; color:var(--muted); display:flex; flex-direction:column; gap:10px }
  .closeBtn{ margin-left:auto }

  /* Floating helpers */
  .floating{ position:fixed; right:18px; bottom:18px; z-index:60 }

  /* footer */
  footer{ text-align:center; margin-top:30px; color:rgba(255,255,255,0.45); font-size:13px }

  /* small screens */
  @media(max-width:820px){ .modal .box{ grid-template-columns: 1fr } .controls .searchWrap input{ width:120px } }
  @media(max-width:420px){ .avatar-wrap{ height:160px } .logo{ width:56px; height:56px } }

  /* subtle entrance */
  .fadeIn { animation: cardIn .48s cubic-bezier(.2,.9,.3,1); }
  @keyframes cardIn{ from{ opacity:0; transform: translateY(8px) } to{ opacity:1; transform:none } }

  /* drag & drop highlight */
  .dragover{ outline:3px dashed rgba(255,255,255,0.06); transform:translateY(-4px) }

</style>
</head>
<body>

<canvas id="canvas-bg" style="position:fixed;inset:0;z-index:0;pointer-events:none"></canvas>

<div class="wrap">
  <header class="top">
    <div class="brand">
      <div class="logo" aria-hidden>V</div>
      <div class="title">
        <h1>Vicky varun ‚Ä¢ instagram Friends</h1>
        <p class="lead">Not Just a Page, It‚Äôs Our Premium Identity</p>
      </div>
    </div>

    <div class="controls">
      <div class="searchWrap" title="Search friends">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm9 3-5.2-5.2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="searchInput" placeholder="Search name or username" aria-label="Search friends" />
      </div>
      <button id="addBtn" class="btn primary">Add Friend</button>
      <button id="loginBtn" class="btn">Admin Login</button>
      <button id="logoutBtn" class="btn ghost" style="display:none">Logout</button>
    </div>
  </header>

  <main>
    <section class="gallery" id="gallery" aria-live="polite"></section>
  </main>

  <footer>
    ¬© <span id="year">2025</span> ‚Ä¢ Built with ‚ù§Ô∏è by Vicky varun üòé ‚Äî Premium website
  </footer>
</div>

<!-- Hidden inputs -->
<input id="fileInput" type="file" accept="image/*" style="display:none" />

<!-- Contest / Engagement Rules Modal trigger -->
<div style="display:flex;gap:8px;margin-top:12px;align-items:center;padding-left:20px">
  <button id="viewRulesBtn" class="btn" style="background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));">View Engagement Rules</button>
  <button id="claimBtn" class="btn primary">Submit Claim</button>
</div>

<!-- Rules Modal -->
<div id="rulesModal" class="modal" aria-hidden="true">
  <div class="box" style="max-width:900px;grid-template-columns:1fr;padding:18px;">
    <div style="color:#fff">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <h2 style="margin:0">Engagement Rules ‚Äî my instagram supporter</h2>
        <button id="closeRules" class="btn closeBtn">Close</button>
      </div>
      <p style="color:var(--muted);margin-bottom:8px">You can get the feature by following the below actions ‚Äì after verification.</p>
      <ol style="color:var(--muted);line-height:1.6">
        <li><strong>eligibility:</strong> Anyone who does this on my Instagram page (Like, Comment, Share to Story, Tag, Mention, Follow, Repost Reel to Story) is eligible to participate.</li>
        <li><strong>Which ones Actions will be counted:</strong>
          <ul>
            <li>Like all the posts on <em>Instagram</em></li>
            <li><em>Comment</em> At least 3 posts</li>
            <li><em>Share to Story</em> and mention on my Instagram account @vickyvarun32</li>
            <li><em>Tag</em> ‚Äî Tagging a friend (on a post)</li>
            <li><em>Mention</em> in captions or stories</li>
            <li><em>Follow</em> ‚Äî Become a new follower and tell others about the page</li>
            <li><em>Reel share</em> ‚Äî Post my reel, picture on your story and tag me</li>
          </ul>
        </li>
        <li><strong>Proof / verification:</strong> We need 4 activities on our Instagram page vickvarun32 to put name and picture on website:</li>
        <li><strong>How to claim:</strong> Click the "Submit Claim" button below and upload your Instagram username and proof. We'll verify it and update it within 3-7 days.‡•§</li>
        <li><strong>those who will deceive:</strong> Any fake/bot activity, multiple fake accounts or spam will result in the claim being cancelled and the account being blocked.</li>
        <li><strong>Disclaimer:</strong> The final decision rests with the admin. The rewards/feature are non-transferable.</li>
      </ol>
      <p style="color:var(--muted)"><strong>Note:</strong> This site is for community engagement only - not advertising any kind of payment or claiming prizes (if you really want to offer some monetary reward, you can deal with the admin separately)‡•§</p>
    </div>
  </div>
</div>

<!-- Claim Modal -->
<div id="claimModal" class="modal" aria-hidden="true">
  <div class="box" style="max-width:480px;grid-template-columns:1fr;padding:0;border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#0b001f,#12003b,#1c004c);box-shadow:0 0 30px rgba(0,0,0,0.8);">
    <div style="padding:28px;color:#fff;text-align:center">
      <h2 style="margin:0 0 12px;font-weight:700;font-size:22px;color:#fff;">Submit Your Claim</h2>
      <p style="font-size:14px;color:rgba(255,255,255,0.7);margin-bottom:20px;">
        Show your support ‚Äî Like, Comment, Tag or Share on Instagram!
      </p>

      <form id="claimForm" style="display:flex;flex-direction:column;gap:14px;text-align:left;color:#ddd;">
        <div>
          <label style="font-size:13px;">Instagram Username</label><br>
          <input id="claimUser" required placeholder="@your_handle"
            style="width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#fff;font-size:14px;outline:none;">
        </div>

        <div>
          <label style="font-size:13px;">Action Performed</label><br>
          <select id="claimAction"
            style="width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#fff;font-size:14px;outline:none;">
            <option value="Like">Like</option>
            <option value="Comment">Comment</option>
            <option value="Tag">Tag</option>
            <option value="Share">Share</option>
            <option value="Mention">Mention</option>
            <option value="Follow">Follow</option>
            <option value="Reel Share">Reel Share</option>
          </select>
        </div>

        <div>
          <label style="font-size:13px;">Attach Proof (optional)</label><br>
          <input id="claimFile" type="file" accept="image/*"
            style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#ccc;font-size:14px;">
        </div>

        <div>
          <label style="font-size:13px;">Post Link / Message</label><br>
          <input id="claimNote" placeholder="Link or short note"
            style="width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:#fff;font-size:14px;">
        </div>

        <div style="display:flex;gap:10px;margin-top:10px;">
          <button type="submit" class="btn" 
            style="flex:1;padding:10px 12px;border:none;border-radius:10px;
            background:linear-gradient(90deg,#ff4dd2,#00f0ff);
            color:#fff;font-weight:700;cursor:pointer;
            box-shadow:0 0 12px rgba(0,240,255,0.5);
            transition:all 0.3s;">
            Submit Claim
          </button>
          <button type="button" id="clearClaim" class="btn"
            style="padding:10px 12px;border:none;border-radius:10px;
            background:rgba(255,255,255,0.1);color:#fff;cursor:pointer;">
            Clear
          </button>
        </div>

        <p id="claimResp" style="text-align:center;font-size:13px;color:#8aff6b;margin-top:8px;"></p>
        <p style="font-size:13px;text-align:center;color:rgba(255,255,255,0.7);margin-top:6px;">
          We'll verify your action within 3‚Äì7 days üåô
        </p>
      </form>

      <button id="closeClaim" class="btn closeBtn"
        style="margin-top:16px;background:transparent;border:none;color:#aaa;cursor:pointer;font-size:13px;">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Modal viewer -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="box">
    <div class="imgWrap"><img id="modalImg" alt=""/></div>
    <div class="side">
      <div style="display:flex;align-items:center;gap:10px"><h3 id="modalName" style="color:#fff;margin:0"></h3><button id="closeModal" class="btn closeBtn">Close</button></div>
      <div id="modalMeta" class="meta"></div>
      <div style="margin-top:auto;display:flex;gap:8px"><button id="downloadImg" class="btn primary">Download</button><a id="openInInst" class="btn" target="_blank" rel="noopener">Open Instagram</a></div>
    </div>
  </div>
</div>

<!-- Floating admin/upload -->
<div class="floating">
  <button id="exportBtn" class="btn">Export</button>
  <button id="importBtn" class="btn">Import</button>
</div>

<script>
// Put all DOM access and event wiring inside DOMContentLoaded to avoid null refs
document.addEventListener('DOMContentLoaded', () => {
  // ---------- Configuration ----------
  const ADMIN_PASSWORD = "Vicky@123";
  let friends = [
    { id:"fr1", name:"Abhishek Mandal", insta:"https://instagram.com/abhishek___mandal_18" },
    { id:"fr2", name:"Sunil Raj", insta:"https://instagram.com/sunil__raj__x01" },
    { id:"fr3", name:"Himanshu Roy", insta:"https://instagram.com/himanshu_roy14" },
    { id:"fr4", name:"Om Choudhary", insta:"https://instagram.com/_pranav_jack15" },
    { id:"fr5", name:"Raghav Kumar Jha", insta:"https://instagram.com/raghav_jha_pandit" },
    { id:"fr6", name:"Subham Kumar", insta:"https://instagram.com/killer.__.shubham" },
    { id:"fr7", name:"Vivek Roy", insta:"https://instagram.com/ll_kittu__01_ll" },
    { id:"fr8", name:"Om Kumar", insta:"https://instagram.com/wish_master_om_07" },
    { id:"fr9", name:"Dilkhush Kumar", insta:"https://instagram.com/_heart__killar01" },
    { id:"fr10", name:"Sonu Kumar", insta:"https://instagram.com/__singh_._sahab__" },
    { id:"fr11", name:"Chhotu Kumar", insta:"https://instagram.com/chhotu_kashyap_______" },
    { id:"fr12", name:"Purshottam Choudhary", insta:"https://instagram.com/choudhary_official_007" },
    { id:"fr13", name:"Rahul Kumar", insta:"https://instagram.com/i.amrahul2" },
    { id:"fr14", name:"Abhishek Kumar", insta:"https://instagram.com/real_life_struggle1" },
    { id:"fr15", name:"Sachidanand Kumar", insta:"https://instagram.com/prime_s4chida" }
  ];

  let saved = JSON.parse(localStorage.getItem('vicky_friends_photos') || '{}');

  // ---------- DOM refs (safe) ----------
  const gallery = document.getElementById('gallery');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const addBtn = document.getElementById('addBtn');
  const fileInput = document.getElementById('fileInput');
  const searchInput = document.getElementById('searchInput');
  const modal = document.getElementById('modal');
  const modalImg = document.getElementById('modalImg');
  const modalName = document.getElementById('modalName');
  const modalMeta = document.getElementById('modalMeta');
  const closeModal = document.getElementById('closeModal');
  const downloadImg = document.getElementById('downloadImg');
  const openInInst = document.getElementById('openInInst');
  const exportBtn = document.getElementById('exportBtn');
  const importBtn = document.getElementById('importBtn');

  // Rules / claim elements (may not exist in some templates) - guard
  const viewRulesBtn = document.getElementById('viewRulesBtn');
  const rulesModal = document.getElementById('rulesModal');
  const closeRules = document.getElementById('closeRules');
  const claimBtn = document.getElementById('claimBtn');
  const claimModal = document.getElementById('claimModal');
  const closeClaim = document.getElementById('closeClaim');
  const claimForm = document.getElementById('claimForm');
  const claimResp = document.getElementById('claimResp');

  let currentUploadTarget = null;

  // ---------- Helpers ----------
  function isAdmin(){ return sessionStorage.getItem('vf_admin') === '1'; }
  function setAdmin(v){ if(v) sessionStorage.setItem('vf_admin','1'); else sessionStorage.removeItem('vf_admin'); render(); updateAdminUI(); }
  function updateAdminUI(){ const a = isAdmin(); if(loginBtn) loginBtn.style.display = a ? 'none' : 'inline-block'; if(logoutBtn) logoutBtn.style.display = a ? 'inline-block' : 'none'; document.querySelectorAll('.admin-only').forEach(el=>el.style.display = a ? 'flex' : 'none'); }

  function initials(name){ if(!name) return ''; const parts = name.trim().split(/\s+/).filter(Boolean); if(parts.length===1) return parts[0].slice(0,2).toUpperCase(); return (parts[0][0]+parts[parts.length-1][0]).toUpperCase(); }

  function pickGradient(seed){ const list = [ ['#ff9a9e','#fecfef'], ['#f6d365','#fda085'], ['#a1c4fd','#c2e9fb'], ['#fbc2eb','#a6c1ee'], ['#ffecd2','#fcb69f'], ['#89f7fe','#66a6ff'] ]; let s=0; for(let i=0;i<seed.length;i++) s+=seed.charCodeAt(i); return list[s % list.length]; }

  function drawAvatarDataUrl(name, w=1200, h=900){ const c = document.createElement('canvas'); c.width=w; c.height=h; const ctx = c.getContext('2d'); const grad = pickGradient(name||'A'); const g = ctx.createLinearGradient(0,0,w,h); g.addColorStop(0, grad[0]); g.addColorStop(1, grad[1]); ctx.fillStyle = g; ctx.fillRect(0,0,w,h); ctx.globalAlpha = 0.06; for(let i=0;i<1200;i++){ ctx.fillStyle = 'rgba(255,255,255,0.03)'; ctx.fillRect(Math.random()*w, Math.random()*h, 1, 1); } ctx.globalAlpha = 1; const txt = initials(name); ctx.fillStyle = 'rgba(255,255,255,0.96)'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font = Math.floor(w/6) + 'px Poppins, Arial'; ctx.fillText(txt, w/2, h/2+30); return c.toDataURL('image/png'); }

  // ---------- Card creation ----------
  function createCard(member){
    const c = document.createElement('article'); c.className = 'card fadeIn'; c.setAttribute('data-id', member.id);
    const avatarWrap = document.createElement('div'); avatarWrap.className = 'avatar-wrap';
    const img = document.createElement('img'); img.alt = member.name; img.loading = 'lazy'; img.src = saved[member.id] || member.image || drawAvatarDataUrl(member.name);
    avatarWrap.appendChild(img);
    c.appendChild(avatarWrap);

    const info = document.createElement('div'); info.className = 'info';
    const nameEl = document.createElement('div'); nameEl.className = 'name'; nameEl.textContent = member.name; info.appendChild(nameEl);
    const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = member.insta || 'No Instagram'; info.appendChild(meta);

    const actionWrap = document.createElement('div'); actionWrap.className = 'card-controls';
    const viewBtn = document.createElement('button'); viewBtn.className = 'btn'; viewBtn.textContent = 'Preview'; viewBtn.onclick = ()=> openModal(member, img.src);
    actionWrap.appendChild(viewBtn);

    if(member.insta){ const a = document.createElement('a'); a.className = 'insta-btn'; a.href = member.insta; a.target='_blank'; a.rel='noopener noreferrer'; a.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Instagram</span>'; info.appendChild(a); }

    // admin controls
    const adminArea = document.createElement('div'); adminArea.className = 'card-controls admin-only';
    const uploadBtn = document.createElement('button'); uploadBtn.className = 'btn'; uploadBtn.textContent = 'Upload'; uploadBtn.onclick = ()=> { currentUploadTarget = member.id; if(fileInput) fileInput.click(); };
    const resetBtn = document.createElement('button'); resetBtn.className = 'btn'; resetBtn.textContent = 'Reset'; resetBtn.onclick = ()=> { if(confirm('Reset image for '+member.name+'?')){ delete saved[member.id]; localStorage.setItem('vicky_friends_photos', JSON.stringify(saved)); render(); } };
    const editBtn = document.createElement('button'); editBtn.className='btn'; editBtn.textContent='Edit'; editBtn.onclick = ()=> editMember(member.id);
    adminArea.appendChild(uploadBtn); adminArea.appendChild(resetBtn); adminArea.appendChild(editBtn);
    info.appendChild(adminArea);

    c.appendChild(info);

    // click whole card to preview (but not when clicking buttons/links)
    c.addEventListener('click', (e)=>{ if(e.target.closest && e.target.closest('.btn')) return; if(e.target.tagName==='A') return; openModal(member, img.src); });

    // drag & drop support for admin
    c.addEventListener('dragover', (ev)=>{ ev.preventDefault(); c.classList.add('dragover'); });
    c.addEventListener('dragleave', ()=> c.classList.remove('dragover'));
    c.addEventListener('drop', async (ev)=>{ ev.preventDefault(); c.classList.remove('dragover'); if(!isAdmin()) return alert('Enable admin to upload'); const file = ev.dataTransfer.files[0]; if(file) await handleFileUploadFor(member.id, file); });

    return c;
  }

  // ---------- Render ----------
  function render(filter=''){
    if(!gallery) return;
    gallery.innerHTML='';
    const q = (filter||'').trim().toLowerCase();
    const list = friends.filter(f=> !q || f.name.toLowerCase().includes(q) || (f.insta||'').toLowerCase().includes(q));
    if(list.length===0){ gallery.innerHTML = '<div style="padding:20px;color:var(--muted)">No results</div>'; return; }
    list.forEach(f=> gallery.appendChild(createCard(f)));
  }

  // ---------- Modal ----------
  function openModal(member, src){ if(!modal) return; modal.classList.add('open'); modalImg.src = src; modalImg.alt = member.name; modalName.textContent = member.name; modalMeta.textContent = member.insta || 'No Instagram link'; if(downloadImg) downloadImg.onclick = ()=> downloadDataUrl(src, member.name.replace(/\s+/g,'_')+'.jpg'); if(openInInst) openInInst.href = member.insta || '#'; }
  if(closeModal) closeModal.addEventListener('click', ()=> modal && modal.classList.remove('open'));
  if(modal) modal.addEventListener('click', (e)=> { if(e.target===modal) modal.classList.remove('open'); });

  // ---------- File upload ----------
  if(fileInput) fileInput.addEventListener('change', async (ev)=>{ const f = ev.target.files[0]; if(!f) return; if(!currentUploadTarget) return alert('Upload target not selected'); await handleFileUploadFor(currentUploadTarget, f); currentUploadTarget = null; fileInput.value=''; });

  async function handleFileUploadFor(id, file){ try{ const dataURL = await readFileAsDataURL(file); const resized = await resizeDataUrl(dataURL, 1400, 1000, 0.88); saved[id]=resized; localStorage.setItem('vicky_friends_photos', JSON.stringify(saved)); render(searchInput ? searchInput.value : ''); }catch(err){ alert('Upload error: '+err.message); } }
  function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=e=>rej(e); r.readAsDataURL(file); }); }
  function resizeDataUrl(dataUrl, maxW, maxH, quality=0.9){ return new Promise(res=>{ const img = new Image(); img.onload = ()=>{ let {width:w, height:h} = img; const ratio = Math.min(maxW/w, maxH/h, 1); const nw = Math.round(w*ratio), nh = Math.round(h*ratio); const c = document.createElement('canvas'); c.width=nw; c.height=nh; const ctx = c.getContext('2d'); ctx.drawImage(img,0,0,nw,nh); res(c.toDataURL('image/jpeg', quality)); }; img.src = dataUrl; }); }

  // ---------- Utilities ----------
  function downloadDataUrl(dataUrl, filename){ const a = document.createElement('a'); a.href = dataUrl; a.download = filename; a.click(); }

  // ---------- Admin & UI ----------
  if(loginBtn) loginBtn.addEventListener('click', ()=>{ const p = prompt('Enter admin password:'); if(p===ADMIN_PASSWORD){ setAdmin(true); alert('Admin enabled'); } else if(p!==null) alert('Wrong password'); });
  if(logoutBtn) logoutBtn.addEventListener('click', ()=>{ if(confirm('Logout admin?')) setAdmin(false); });

  function editMember(id){ const m = friends.find(x=>x.id===id); if(!m) return; const newName = prompt('Edit name', m.name); if(newName===null) return; const newInsta = prompt('Edit Instagram URL (leave blank to remove)', m.insta||''); if(newName.trim()) m.name = newName.trim(); m.insta = newInsta.trim() || ''; render(searchInput ? searchInput.value : ''); }

  if(addBtn) addBtn.addEventListener('click', ()=>{ if(!isAdmin()){ alert('Enable admin to add friends'); return; } const name = prompt('Friend name:'); if(!name) return; const insta = prompt('Instagram URL (optional)'); const id = 'fr'+(Date.now().toString(36)); friends.unshift({ id, name: name.trim(), insta: (insta||'').trim() }); render(searchInput ? searchInput.value : ''); });

  if(searchInput) searchInput.addEventListener('input', (e)=> render(e.target.value));

  // Export / Import
  if(exportBtn) exportBtn.addEventListener('click', ()=>{ const data = { saved, friends }; const blob = new Blob([JSON.stringify(data, null, 2)], { type:'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'vicky_friends_export.json'; a.click(); URL.revokeObjectURL(url); });
  if(importBtn) importBtn.addEventListener('click', ()=>{ const f = document.createElement('input'); f.type='file'; f.accept='application/json'; f.onchange = async (e)=>{ const file = e.target.files[0]; if(!file) return; const txt = await file.text(); try{ const obj = JSON.parse(txt); if(obj.saved) { saved = obj.saved; localStorage.setItem('vicky_friends_photos', JSON.stringify(saved)); if(obj.friends) friends = obj.friends; alert('Imported data'); render(); } else alert('Invalid file'); }catch(err){ alert('Import error: '+err.message); } }; f.click(); });

  // ---------- Canvas particles (light) ----------
  (function initParticles(){ const canvas = document.getElementById('canvas-bg'); if(!canvas) return; const ctx = canvas.getContext('2d'); let w=canvas.width=innerWidth, h=canvas.height=innerHeight; const count = Math.round((w*h)/90000); const particles = []; for(let i=0;i<count;i++){ particles.push({ x: Math.random()*w, y: Math.random()*h, vx:(Math.random()-0.5)*0.6, vy:(Math.random()-0.5)*0.6, r:0.6+Math.random()*2.2, hue: 170+Math.random()*160 }); }
    function loop(){ ctx.clearRect(0,0,w,h); for(const p of particles){ p.x += p.vx; p.y += p.vy; if(p.x< -20) p.x = w+20; if(p.x> w+20) p.x = -20; if(p.y< -20) p.y = h+20; if(p.y> h+20) p.y = -20; const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*6); g.addColorStop(0, `hsla(${p.hue},90%,70%,0.10)`); g.addColorStop(1, `hsla(${p.hue},50%,40%,0)`); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,p.r*6,0,Math.PI*2); ctx.fill(); } requestAnimationFrame(loop); }
    window.addEventListener('resize', ()=>{ w=canvas.width=innerWidth; h=canvas.height=innerHeight; }); loop(); })();

  // ---------- Claims storage & UI ----------
  const CLAIMS_KEY = 'vicky_engagement_claims';
  function loadClaims(){ try{ return JSON.parse(localStorage.getItem(CLAIMS_KEY) || '[]'); }catch(e){ return []; } }
  function saveClaims(list){ localStorage.setItem(CLAIMS_KEY, JSON.stringify(list)); }

  // Wire up Rules & Claim modals safely
  if(viewRulesBtn && rulesModal) viewRulesBtn.addEventListener('click', ()=>{ rulesModal.classList.add('open'); rulesModal.removeAttribute('aria-hidden'); });
  if(closeRules && rulesModal) closeRules.addEventListener('click', ()=>{ rulesModal.classList.remove('open'); rulesModal.setAttribute('aria-hidden','true'); });
  if(claimBtn && claimModal) claimBtn.addEventListener('click', ()=>{ claimModal.classList.add('open'); claimModal.removeAttribute('aria-hidden'); });
  if(closeClaim && claimModal) closeClaim.addEventListener('click', ()=>{ claimModal.classList.remove('open'); claimModal.setAttribute('aria-hidden','true'); });
  if(rulesModal) rulesModal.addEventListener('click', (e)=>{ if(e.target===rulesModal){ rulesModal.classList.remove('open'); rulesModal.setAttribute('aria-hidden','true'); } });
  if(claimModal) claimModal.addEventListener('click', (e)=>{ if(e.target===claimModal){ claimModal.classList.remove('open'); claimModal.setAttribute('aria-hidden','true'); } });

  // Claim form submit
  if(claimForm){
    claimForm.addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      if(claimResp) claimResp.textContent = '';
      const usernameEl = document.getElementById('claimUser');
      const actionEl = document.getElementById('claimAction');
      const noteEl = document.getElementById('claimNote');
      const fileInputClaim = document.getElementById('claimFile');
      const username = usernameEl ? usernameEl.value.trim() : '';
      const action = actionEl ? actionEl.value : '';
      const note = noteEl ? noteEl.value.trim() : '';
      if(!username){ if(claimResp) claimResp.textContent = 'Please enter your Instagram username (like @you).'; return; }

      // optional file read
      let proofData = '';
      if(fileInputClaim && fileInputClaim.files && fileInputClaim.files[0]){
        try{ proofData = await readFileAsDataURL(fileInputClaim.files[0]); }
        catch(e){ console.warn('file read err', e); }
      }

      const claims = loadClaims();
      const id = 'cl_'+Date.now().toString(36);
      const entry = { id, username, action, note, proofData, status:'pending', created: (new Date()).toISOString() };
      claims.unshift(entry);
      saveClaims(claims);

      if(claimResp){ claimResp.style.color = 'lightgreen'; claimResp.textContent = 'Claim submitted ‚Äî hum verify kar ke 3-7 din me update karenge.'; }
      claimForm.reset();

      // optionally notify admin (in-page)
      showAdminNotice('New claim submitted by ' + username);
    });

    const clearBtn = document.getElementById('clearClaim');
    if(clearBtn) clearBtn.addEventListener('click', ()=>{ claimForm.reset(); if(claimResp) claimResp.textContent = ''; });
  }

  // Admin claims viewer button (added to floating area)
  function ensureClaimsButton(){
    if(document.getElementById('viewClaimsBtn')) return;
    const btn = document.createElement('button'); btn.id = 'viewClaimsBtn'; btn.className = 'btn admin-only'; btn.textContent = 'View Claims';
    btn.style.marginTop = '8px';
    btn.addEventListener('click', ()=> openClaimsPanel());
    const floating = document.querySelector('.floating');
    if(floating) floating.appendChild(btn);
    updateAdminUI();
  }
  ensureClaimsButton();

  function openClaimsPanel(){
    const claims = loadClaims();
    // simple admin review UI using a popup window (keeps file self-contained)
    if(!isAdmin()){ alert('Enable admin to view claims'); return; }
    if(claims.length===0){ alert('No claims yet'); return; }

    let list = `Claims (most recent first)\n\n`;
    claims.forEach((c,i)=>{
      list += `${i+1}. ${c.username} ‚Äî ${c.action} ‚Äî ${c.status} ‚Äî ${new Date(c.created).toLocaleString()}\n   Note: ${c.note || '-'}\n   Proof: ${c.proofData? '[attached]' : '-'}\n\n`;
    });

    const w = window.open('', '_blank', 'width=900,height=600,scrollbars=yes');
    if(!w) return alert('Popup blocked ‚Äî allow popups to view claims');
    w.document.title = 'Engagement Claims ‚Äî Admin';
    const pre = w.document.createElement('pre'); pre.style.whiteSpace='pre-wrap'; pre.style.fontSize='13px'; pre.style.padding='12px'; pre.textContent = list; w.document.body.appendChild(pre);
    const info = w.document.createElement('div'); info.style.padding='12px';
    const note = w.document.createElement('div'); note.textContent = 'To update status: run updateClaimStatus(claimId, status) in the console of this window.'; note.style.opacity=0.8; info.appendChild(note);
    w.document.body.insertBefore(info, pre);

    // expose helper to update status from the popup console
    w.updateClaimStatus = function(claimId, status){
      const all = loadClaims();
      const idx = all.findIndex(x=>x.id===claimId);
      if(idx===-1) return alert('claim not found');
      all[idx].status = status;
      saveClaims(all);
      alert('Updated. Refresh original page to see changes.');
    };
  }

  // small admin notice banner
  function showAdminNotice(text){
    if(!isAdmin()) return; // only show when admin
    const el = document.createElement('div'); el.textContent = text; el.style.position='fixed'; el.style.left='18px'; el.style.top='18px'; el.style.background='linear-gradient(90deg,#00f0ff22,#ff4dd222)'; el.style.padding='10px 12px'; el.style.border='1px solid rgba(255,255,255,0.06)'; el.style.borderRadius='10px'; el.style.zIndex=9999; document.body.appendChild(el);
    setTimeout(()=> el.remove(), 7000);
  }

  // ---------- Init ----------
  (function init(){
    const yearEl = document.getElementById('year'); if(yearEl) yearEl.textContent = new Date().getFullYear();
    updateAdminUI();
    render();
  })();

}); // DOMContentLoaded
</script>
</body>
</html>
